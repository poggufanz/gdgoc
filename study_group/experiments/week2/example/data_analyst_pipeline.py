# -*- coding: utf-8 -*-
"""Data-Analyst-pipeline.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1iFU-GpNPbRa34UTUlT8_2A0n4yBcV2z0

# Data Analysis Pipeline - Lazada Seller Dataset

Notebook ini berisi implementasi dasar untuk analisis data dan preprocessing menggunakan:
- NumPy: Operasi array dan perhitungan numerik
- Pandas: Manipulasi dan analisis data
- Matplotlib/Seaborn: Visualisasi data
- Scikit-learn: Preprocessing data

## 1. Import Libraries
"""

# Import library dasar untuk analisis data
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.preprocessing import StandardScaler, LabelEncoder
import warnings
warnings.filterwarnings('ignore')

# Setting visualisasi
plt.style.use('default')
sns.set_palette("husl")

"""## 2. Load Dataset"""

# Load dataset menggunakan Pandas
df = pd.read_csv('Lazada-seller.csv')

print(f"Jumlah baris: {len(df)}")
print(f"Jumlah kolom: {len(df.columns)}")

"""## 3. Eksplorasi Data Awal"""

# Melihat 5 baris pertama
df.head()

# Informasi tipe data dan missing values
df.info()

# Statistik deskriptif untuk kolom numerik
df.describe()

# Cek missing values
print("Missing values per kolom:")
print(df.isnull().sum())

"""## 4. Data Cleaning"""

# Cek duplikat data
print(f"Jumlah duplikat: {df.duplicated().sum()}")

# Hapus duplikat jika ada
df = df.drop_duplicates()
print(f"Jumlah baris setelah hapus duplikat: {len(df)}")

# Handle missing values - hapus baris dengan missing values
df_clean = df.dropna()
print(f"Jumlah baris setelah hapus missing values: {len(df_clean)}")

# Menggunakan NumPy untuk operasi pada kolom numerik
# Contoh: konversi ke array numpy
price_array = np.array(df_clean['price'])
rating_array = np.array(df_clean['averageRating'])

print("Statistik harga menggunakan NumPy:")
print(f"Mean: {np.mean(price_array)}")
print(f"Median: {np.median(price_array)}")
print(f"Std: {np.std(price_array)}")

"""## 5. Visualisasi Data"""

# Histogram untuk distribusi harga menggunakan Matplotlib
plt.figure(figsize=(10, 5))
plt.hist(df_clean['price'], bins=30)
plt.xlabel('Harga')
plt.ylabel('Frekuensi')
plt.title('Distribusi Harga Produk')
plt.show()

# Scatter plot untuk relasi harga vs rating menggunakan Matplotlib
plt.figure(figsize=(10, 5))
plt.scatter(df_clean['price'], df_clean['averageRating'])
plt.xlabel('Harga')
plt.ylabel('Rating')
plt.title('Relasi Harga vs Rating')
plt.show()

# Boxplot untuk melihat outlier pada harga menggunakan Seaborn
plt.figure(figsize=(10, 5))
sns.boxplot(data=df_clean, x='price')
plt.title('Boxplot Harga Produk')
plt.show()

# Countplot untuk melihat distribusi brand menggunakan Seaborn
plt.figure(figsize=(12, 6))
top_brands = df_clean['brandName'].value_counts().head(10)
sns.barplot(x=top_brands.values, y=top_brands.index)
plt.xlabel('Jumlah Produk')
plt.ylabel('Brand')
plt.title('Top 10 Brand dengan Produk Terbanyak')
plt.show()

# Heatmap untuk korelasi antar variabel numerik menggunakan Seaborn
plt.figure(figsize=(8, 6))
numeric_cols = df_clean[['price', 'averageRating', 'totalReviews']]
sns.heatmap(numeric_cols.corr(), annot=True)
plt.title('Korelasi Antar Variabel Numerik')
plt.show()

# Pairplot untuk melihat relasi antar variabel numerik
numeric_data = df_clean[['price', 'averageRating', 'totalReviews']]
sns.pairplot(numeric_data)
plt.suptitle('Pairplot Variabel Numerik', y=1.02)
plt.show()

# Violinplot untuk distribusi harga dan rating
plt.figure(figsize=(12, 5))

plt.subplot(1, 2, 1)
sns.violinplot(data=df_clean, y='price')
plt.title('Distribusi Harga')

plt.subplot(1, 2, 2)
sns.violinplot(data=df_clean, y='averageRating')
plt.title('Distribusi Rating')

plt.tight_layout()
plt.show()

# Distplot untuk distribusi harga
plt.figure(figsize=(10, 5))
sns.histplot(df_clean['price'], kde=True, bins=30)
plt.xlabel('Harga')
plt.ylabel('Frekuensi')
plt.title('Distribusi Harga dengan Kurva Densitas')
plt.show()

# Scatterplot dengan hue untuk melihat relasi harga, rating, dan brand
plt.figure(figsize=(12, 6))
top_5_brands = df_clean['brandName'].value_counts().head(5).index
df_top_brands = df_clean[df_clean['brandName'].isin(top_5_brands)]

sns.scatterplot(data=df_top_brands, x='price', y='averageRating', hue='brandName', s=100)
plt.xlabel('Harga')
plt.ylabel('Rating')
plt.title('Relasi Harga vs Rating berdasarkan Top 5 Brand')
plt.legend(title='Brand')
plt.show()

# Countplot untuk distribusi rating
plt.figure(figsize=(10, 5))
sns.countplot(data=df_clean, x='averageRating')
plt.xlabel('Rating')
plt.ylabel('Jumlah Produk')
plt.title('Distribusi Rating Produk')
plt.show()

"""### Analisis dengan GroupBy dan Agregasi"""

# GroupBy brand, hitung rata-rata harga
avg_price_brand = df_clean.groupby('brandName')['price'].mean()

# Urutkan dan ambil top 10
top_10 = avg_price_brand.sort_values(ascending=False).head(10)

# Visualisasi
plt.figure(figsize=(12, 6))
sns.barplot(x=top_10.values, y=top_10.index)

plt.xlabel('Rata-rata Harga')
plt.ylabel('Brand')
plt.title('Top 10 Brand dengan Rata-rata Harga Tertinggi')
plt.show()

# GroupBy brand, hitung rata-rata rating
avg_rating_brand = df_clean.groupby('brandName')['averageRating'].mean()

# Urutkan dan ambil top 10
top_10 = avg_rating_brand.sort_values(ascending=False).head(10)

# Visualisasi
plt.figure(figsize=(12, 6))
sns.barplot(x=top_10.values, y=top_10.index, palette='viridis')

plt.xlabel('Rata-rata Rating')
plt.ylabel('Brand')
plt.title('Top 10 Brand dengan Rata-rata Rating Tertinggi')
plt.show()

# GroupBy brand, jumlahkan total reviews
total_reviews = df_clean.groupby('brandName')['totalReviews'].sum()

# Urutkan dan ambil top 10
top_10 = total_reviews.sort_values(ascending=False).head(10)

# Visualisasi
plt.figure(figsize=(12, 6))
sns.barplot(x=top_10.values, y=top_10.index, palette='coolwarm')

plt.xlabel('Total Reviews')
plt.ylabel('Brand')
plt.title('Top 10 Brand dengan Total Reviews Terbanyak')
plt.show()

# GroupBy brand dengan multiple agregasi
brand_stats = df_clean.groupby('brandName').agg({
    'itemId': 'count',           # Hitung jumlah produk
    'price': 'mean',             # Rata-rata harga
    'averageRating': 'mean'      # Rata-rata rating
})

# Rename kolom dan ambil top 10
brand_stats = brand_stats.rename(columns={'itemId': 'jumlah_produk'})

brand_stats = brand_stats.sort_values('jumlah_produk', ascending=False).head(10)

print("Statistik Top 10 Brand:")
print(brand_stats)

# Buat 2 subplot untuk perbandingan
fig, axes = plt.subplots(1, 2, figsize=(15, 6))

# Chart 1: Jumlah produk
axes[0].barh(brand_stats.index, brand_stats['jumlah_produk'])
axes[0].set_xlabel('Jumlah Produk')
axes[0].set_ylabel('Brand')
axes[0].set_title('Jumlah Produk per Brand')

# Chart 2: Rata-rata harga
axes[1].barh(brand_stats.index, brand_stats['price'])
axes[1].set_xlabel('Rata-rata Harga')
axes[1].set_ylabel('Brand')
axes[1].set_title('Rata-rata Harga per Brand')

plt.tight_layout()
plt.show()

# GroupBy kategori, hitung rata-rata harga
category_price = df_clean.groupby('category')['price'].mean()

# Urutkan dan ambil top 10
top_10 = category_price.sort_values(ascending=False).head(10)

# Visualisasi
plt.figure(figsize=(12, 6))
sns.barplot(x=top_10.values, y=top_10.index, palette='magma')

plt.xlabel('Rata-rata Harga')
plt.ylabel('Kategori')
plt.title('Top 10 Kategori dengan Rata-rata Harga Tertinggi')
plt.show()

# Boxplot untuk melihat distribusi harga per rating
plt.figure(figsize=(12, 6))
sns.boxplot(data=df_clean, x='averageRating', y='price')
plt.xlabel('Rating')
plt.ylabel('Harga')
plt.title('Distribusi Harga Berdasarkan Rating')
plt.show()

# Buat kategori berdasarkan jumlah reviews
df_clean['review_category'] = pd.cut(df_clean['totalReviews'],
                                      bins=[0, 10, 50, 100, float('inf')],
                                      labels=['Sedikit', 'Sedang', 'Banyak', 'Sangat Banyak'])

# GroupBy kategori reviews, hitung rata-rata harga
review_price = df_clean.groupby('review_category')['price'].mean()

# Visualisasi
plt.figure(figsize=(10, 6))
sns.barplot(x=review_price.index, y=review_price.values, palette='rocket')
plt.xlabel('Kategori Reviews')
plt.ylabel('Rata-rata Harga')
plt.title('Rata-rata Harga Berdasarkan Kategori Reviews')
plt.show()

# Filter top 5 brands
top_brands = df_clean['brandName'].value_counts().head(5).index
df_filtered = df_clean[df_clean['brandName'].isin(top_brands)]

# Buat pivot table: rata-rata harga per brand dan rating
pivot_table = df_filtered.pivot_table(values='price',
                                       index='brandName',
                                       columns='averageRating',
                                       aggfunc='mean')

# Visualisasi heatmap
plt.figure(figsize=(12, 6))
sns.heatmap(pivot_table, annot=True, fmt='.0f', cmap='YlOrRd')
plt.xlabel('Rating')
plt.ylabel('Brand')
plt.title('Rata-rata Harga per Brand dan Rating')
plt.show()

"""## 6. Feature Engineering"""

# Membuat fitur baru menggunakan Pandas
# Contoh: kategori harga berdasarkan rentang

df_clean['price_category'] = pd.cut(df_clean['price'],
                                     bins=[0, 100000, 500000, 1000000, float('inf')],
                                     labels=['Murah', 'Sedang', 'Mahal', 'Sangat Mahal'])

print(df_clean[['price', 'price_category']].head())

# Membuat fitur kategori rating
df_clean['rating_category'] = pd.cut(df_clean['averageRating'],
                                      bins=[0, 2, 3, 4, 5],
                                      labels=['Buruk', 'Cukup', 'Baik', 'Sangat Baik'])

print(df_clean[['averageRating', 'rating_category']].head())

"""## 7. Preprocessing dengan Scikit-learn"""

# Label Encoding untuk kolom kategorikal
label_encoder = LabelEncoder()

# Encode kolom brandName
df_clean['brandName_encoded'] = label_encoder.fit_transform(df_clean['brandName'])

print("Brand Name Encoding:")
print(df_clean[['brandName', 'brandName_encoded']].head())

# Standardisasi fitur numerik menggunakan StandardScaler
scaler = StandardScaler()

# Pilih kolom numerik untuk standardisasi
numeric_features = ['price', 'averageRating', 'totalReviews']

# Fit dan transform data
df_clean[['price_scaled', 'rating_scaled', 'reviews_scaled']] = scaler.fit_transform(df_clean[numeric_features])

print("Data sebelum dan sesudah scaling:")
print(df_clean[['price', 'price_scaled', 'averageRating', 'rating_scaled']].head())

# Visualisasi perbandingan data sebelum dan sesudah scaling
fig, axes = plt.subplots(1, 2, figsize=(14, 5))

# Sebelum scaling
axes[0].hist(df_clean['price'], bins=30)
axes[0].set_title('Harga Sebelum Scaling')
axes[0].set_xlabel('Harga')
axes[0].set_ylabel('Frekuensi')

# Sesudah scaling
axes[1].hist(df_clean['price_scaled'], bins=30)
axes[1].set_title('Harga Sesudah Scaling')
axes[1].set_xlabel('Harga (Scaled)')
axes[1].set_ylabel('Frekuensi')

plt.tight_layout()
plt.show()

"""## 8. Ringkasan Data Setelah Preprocessing"""

# Tampilkan informasi dataset final
print("Informasi Dataset Setelah Preprocessing:")
print(f"Jumlah baris: {len(df_clean)}")
print(f"Jumlah kolom: {len(df_clean.columns)}")
print(f"\nKolom-kolom yang tersedia:")
print(df_clean.columns.tolist())

# Tampilkan sample data final
print("Sample data setelah preprocessing:")
df_clean.head(10)

# Simpan data yang sudah dipreprocess
df_clean.to_csv('Lazada-seller-processed.csv', index=False)
print("Data berhasil disimpan ke 'Lazada-seller-processed.csv'")